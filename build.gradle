import org.apache.tools.ant.filters.ReplaceTokens

def getVersionFromGit = {
	->
	def standard = new ByteArrayOutputStream()
	def error = new ByteArrayOutputStream()
	exec {
		commandLine 'git', 'describe', '--tags'
		standardOutput = standard
		errorOutput = error
		ignoreExitValue = true
	}

	if (error.toString().isEmpty())
		return standard.toString().trim()
	else
		return 'SNAPSHOT'
}

println("##teamcity[buildNumber '" + getVersionFromGit() + "']");

apply plugin: 'java'
allprojects {
	version = getVersionFromGit()

	processResources {
		filter ReplaceTokens, tokens: [
			'version': getVersion(),
			'year'   : Calendar.getInstance().get(Calendar.YEAR).toString()
		]
	}
}


repositories { mavenCentral() }
dependencies {
	compile project(':cl')

	runtime project(':divisor')
	runtime project(':list')
	runtime project(':quota')
	runtime project(':json')
	runtime project(':as')
}


buildscript {
	repositories {
		jcenter()
	}
	dependencies {
		classpath 'com.github.jengelman.gradle.plugins:shadow:0.8'
	}
}
apply plugin: 'shadow'
shadow {
	outputFile = new File("${project.buildDir}/distributions/", "bazi.jar")
}
jar {
	manifest {
		attributes "Main-Class": "de.uni_augsburg.bazi.cl.BAZI"
	}
}
