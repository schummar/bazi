import org.apache.tools.ant.filters.*

def getVersionFromGit = {
	->
	def standard = new ByteArrayOutputStream()
	def error = new ByteArrayOutputStream()
	exec {
		commandLine 'git', 'describe', '--tags'
		standardOutput = standard
		errorOutput = error
		ignoreExitValue = true
	}

	if (error.toString().isEmpty())
		return standard.toString().trim()
	else
		return 'SNAPSHOT'
}

allprojects { version = getVersionFromGit() }

subprojects {
	apply plugin: 'java'

	sourceCompatibility = 1.7
	targetCompatibility = 1.7

	sourceSets{
		main{
			java{
				srcDirs = [
					'src/main/java/api',
					'src/main/java/impl'
				]
			}
		}
	}

	processResources {
		filter ReplaceTokens, tokens: [
			"version": getVersion()
		]
	}
}

repositories { mavenCentral() }