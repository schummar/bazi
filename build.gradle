import org.apache.tools.ant.filters.ReplaceTokens

def getVersionFromGit = {
	->
	def standard = new ByteArrayOutputStream()
	def error = new ByteArrayOutputStream()
	exec {
		commandLine 'git', 'describe', '--tags'
		standardOutput = standard
		errorOutput = error
		ignoreExitValue = true
	}

	if (error.toString().isEmpty())
		return standard.toString().trim()
	else
		return 'SNAPSHOT'
}

println("##teamcity[buildNumber '" + getVersionFromGit() + "']");

apply plugin: 'java'
allprojects {
	version = getVersionFromGit()

	processResources {
		filter ReplaceTokens, tokens: [
			'version': getVersion(),
			'year'   : Calendar.getInstance().get(Calendar.YEAR).toString()
		]
	}
}

repositories { mavenCentral() }
dependencies {
	compile project(':cl')
}


buildscript {
	repositories { mavenCentral() }

	dependencies { classpath 'eu.appsatori:gradle-fatjar-plugin:0.2' }
}

apply plugin: 'fatjar'

fatJar {
	archiveName = 'bazi.jar'
	manifest { attributes 'Main-Class': 'de.uni_augsburg.bazi.cl.BAZI' }
}
